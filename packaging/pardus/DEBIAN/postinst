#!/bin/bash
# GÃ¼mÃ¼ÅŸDil Kurulum SonrasÄ± Script

set -e

echo "ğŸŒŸ GÃ¼mÃ¼ÅŸDil kurulumu tamamlanÄ±yor..."

# Python baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ± yÃ¼kle (Robust Error Handling)
echo "ğŸ“¦ Python paketleri yÃ¼kleniyor..."

# Ã–nce pip'in kendisini gÃ¼ncelle
python3 -m pip install --upgrade pip --user 2>/dev/null || true

# CustomTkinter ve Pillow'u kur (Kritik baÄŸÄ±mlÄ±lÄ±klar)
if ! python3 -c "import customtkinter" 2>/dev/null; then
    echo "   â†’ CustomTkinter kuruluyor..."
    pip3 install --user customtkinter==5.2.0 2>/dev/null || {
        echo "   âš ï¸  pip baÅŸarÄ±sÄ±z, apt ile deneniyor..."
        apt-get install -y python3-customtkinter 2>/dev/null || true
    }
fi

if ! python3 -c "import PIL" 2>/dev/null; then
    echo "   â†’ Pillow kuruluyor..."
    pip3 install --user pillow 2>/dev/null || {
        apt-get install -y python3-pil python3-pil.imagetk 2>/dev/null || true
    }
fi

echo "âœ… Python baÄŸÄ±mlÄ±lÄ±klarÄ± hazÄ±r"

# Desktop kÄ±sayolu oluÅŸtur
DESKTOP_FILE="/usr/share/applications/gumusdil.desktop"
cat > "$DESKTOP_FILE" << 'EOF'
[Desktop Entry]
Version=1.0
Type=Application
Name=GÃ¼mÃ¼ÅŸDil IDE
Name[tr]=GÃ¼mÃ¼ÅŸDil IDE
Comment=TÃ¼rkÃ§e Programlama Dili
Comment[tr]=TÃ¼rkÃ§e Programlama Dili
Exec=/usr/bin/gumusdil
Icon=/usr/share/gumusdil/icon.png
Terminal=false
Categories=Development;Education;IDE;
Keywords=programming;turkish;education;teknofest;
StartupNotify=true
EOF

# Ä°kon dosyasÄ± yoksa placeholder oluÅŸtur
if [ ! -f "/usr/share/gumusdil/icon.png" ]; then
    echo "âš ï¸  Ä°kon dosyasÄ± bulunamadÄ±, varsayÄ±lan kullanÄ±lacak"
fi

# Ã‡alÄ±ÅŸtÄ±rma izinleri
chmod +x /usr/bin/gumusdil
chmod +x /usr/share/gumusdil/bin/gumus 2>/dev/null || true

# MasaÃ¼stÃ¼ veritabanÄ±nÄ± gÃ¼ncelle
update-desktop-database 2>/dev/null || true

echo "âœ… GÃ¼mÃ¼ÅŸDil baÅŸarÄ±yla kuruldu!"
echo ""
echo "ğŸš€ BaÅŸlatmak iÃ§in:"
echo "   - Uygulama menÃ¼sÃ¼nden 'GÃ¼mÃ¼ÅŸDil IDE' seÃ§in"
echo "   - veya terminalde 'gumusdil' yazÄ±n"
echo ""
echo "ğŸ“š Ã–rnek kodlar: /usr/share/gumusdil/ornekler/"
echo ""

exit 0
