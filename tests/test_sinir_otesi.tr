// ---------------------------------------------------------
// SINIR OTESI TESTLERI (test_sinir_otesi.tr)
// "Gümüshane Sogugu" kadar sert, negatif ve hata testleri.
// GümüşDil'in hata toleransını ve saglamlıgını olcer.
// ---------------------------------------------------------

dahil_et("../lib/birim.tr")
dahil_et("../std_lib/matematik.tr")
dahil_et("../std_lib/liste.tr")
dahil_et("../lib/ai_gelis.tr")

deÄŸiÅŸken t = yeni BirimTest("Sinir Otesi (Negatif) Testler")

// ----------------------------------------------------------------
// 1. BOLUM: MATEMATIK "KARADELIK" TESTLERI
// ----------------------------------------------------------------
t.bolum("MATEMATIK: Beklenmedik deÄŸerler")

// Negatif Faktoriyel:
// Standart fonksiyonumuz su an recursive ve eksi kontrolu yapmiyor olabilir
// Sonsuz donguye girmeden yanit donuyor mu bakalim.
// Beklenen: Ya hata firlatmali ya da 1 donmeli (tanima gore)
t.esit_mi(1, mat_faktoriyel(-5), "Faktoriyel(-5) sistem cokmemeli (1 veya Hata)")

// 0 uzeri 0 Belirsizligi:
// Genellikle 1 kabul edilir.
t.esit_mi(1, mat_Ã¼s(0, 0), "0^0 = 1 olmali")

// SIFIRA BOLME (Kritik!)
// Daktilonun 'dene-yakala' mekanizmasi burada devreye girmeli.
t.bolum("MATEMATIK: Sifira Bolme Yakalama")

deÄŸiÅŸken yakalandi_mi = yanlÄ±ÅŸ
dene {
    deÄŸiÅŸken patlama = 10 / 0
} yakala(hata) {
    yakalandi_mi = doÄŸru
    renkli_yazdir("sari", "  [i] Beklenen hata yakalandi: " + hata)
}
t.dogru_mu(yakalandi_mi, "Sifira bolme hatasi 'dene-yakala' ile tutulmali")


// ----------------------------------------------------------------
// 2. BOLUM: LISTE "HAYALET ELEMAN" TESTLERI
// ----------------------------------------------------------------
t.bolum("LISTE: Sinir Durumlari")

deÄŸiÅŸken bos_liste = []

// boÅŸ listede arama
t.esit_mi(-1, eleman_ara(bos_liste, "hayalet"), "boÅŸ listede eleman arama -1 donmeli")

// Olmayan indeks (Boundary Check)
// GümüşDil su an indeks hatasinda crash mi oluyor yoksa hata mi firlatiyor?
// Test edelim.
yakalandi_mi = yanlÄ±ÅŸ
dene {
    deÄŸiÅŸken olmayan = bos_liste[999]
} yakala(hata) {
    yakalandi_mi = doÄŸru
    renkli_yazdir("sari", "  [i] Index hatasi yakalandi: " + hata)
}
// NOT: EÄŸer dil native seviyede boundary check yapmiyorsa bu test cokebilir (segfault).
// Ancak interpreter dillerinde bu check genelde vardir.
t.dogru_mu(yakalandi_mi, "Gecersiz indeks erisimi hata firlatmali")

// Tip Uyusmazligi: Metin listesinde sayi arama
deÄŸiÅŸken metin_listesi = ["elma", "armut"]
t.esit_mi(-1, eleman_ara(metin_listesi, 12345), "Metin listesinde sayi arandiginda hata vermeden -1 donmeli")


// ----------------------------------------------------------------
// 3. BOLUM: AI "boÅŸ KOVAN" TESTLERI
// ----------------------------------------------------------------
t.bolum("YAPAY ZEKA: Hatali Kullanim")

deÄŸiÅŸken bos_beyin = yeni SinirAgi(-0.5) // Negatif ogrenme orani?

// Katman eklemeden tahmin
yakalandi_mi = yanlÄ±ÅŸ
dene {
    // Katman yokken tahmin yapmaya calisinca donguler calismaz veya hata verir
    // Kodda "katmanlar" boÅŸ oldugu icin dÃ¶ngÃ¼ donmez, sonuc ne doner?
    // Tahminen 0.95 (hardcoded) donecektir ama cokmemeli.
    deÄŸiÅŸken sonuc = bos_beyin.tahmin_et([1])
} yakala(hata) {
    yakalandi_mi = doÄŸru
    renkli_yazdir("sari", "  [i] boÅŸ AI hatasi: " + hata)
}
// Burada hata firlatmasa bile cokmemesi basaridir.
t.dogru_mu(true, "Katmansiz AI calisinca sistem cokmedi")


// ----------------------------------------------------------------
// 4. BOLUM: NESNE "OZ" VE TIP TESTLERI
// ----------------------------------------------------------------
t.bolum("NESNE: Tip Guvenligi")

sinif SaglamSinif {
    deÄŸiÅŸken veri
    kurucu(v) {
        öz.veri = v
        // Burada v'nin tipi kontrol edilmiyor, dinamik tip.
    }
}

// yanlÄ±ÅŸ tipte veri muhurleme
// GümüşDil dinamik tipli oldugu icin bu "hata" degil "ozellik"tir ama
// davranisi gormek lazim.
deÄŸiÅŸken nesne1 = yeni SaglamSinif(123)
deÄŸiÅŸken nesne2 = yeni SaglamSinif("metin")

t.esit_mi(nesne1.veri, 123, "Nesne integer tutabiliyor")
t.esit_mi(nesne2.veri, "metin", "Ayni sinif string tutabiliyor (Dinamik Tip)")

// Kurucu cagirmadan? 
// GümüşDil'de 'yeni' keywordu kurucuyu otomatik cagirir.
// Manuel atlatma sansimiz yok ama kurucuda hata olusursa ne olur?

sinif HataliSinif {
    kurucu() {
        hata_firlat("Kurucuda patlama!")
    }
}

yakalandi_mi = yanlÄ±ÅŸ
dene {
    deÄŸiÅŸken h = yeni HataliSinif()
} yakala(hata) {
    yakalandi_mi = doÄŸru
    renkli_yazdir("sari", "  [i] Kurucu hatasi yakalandi: " + hata)
}
t.dogru_mu(yakalandi_mi, "Nesne olusturulurken yapilan hata yakalanmali")

// ----------------------------------------------------------------
// RAPOR
// ----------------------------------------------------------------
t.raporla()

